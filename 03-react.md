In this session we will create a new react app, and connect it to Winglang backend

## Prerequisites

First, lets verify that you can create a react application using `create-react-app`:
```sh
npx create-react-app client
cd client
npm start
```

The result should be a running react website.
Once you verify it is working you can close the server with `Ctrl-C`

## React in Wing

1. Create a folder named `backend`
2. Create `backend/main.w`
3. run from root: 
  ```sh 
  BROWSER=none wing run backend/main.w
  ```
> BROWSER=none prevents react from starting a new browser window on every run
    
4. Add the following code into `backend/main.w`:
  ```ts
  bring ex;
  bring cloud;
  bring http;
  
  let react = new ex.ReactApp(
    projectPath: "../client",  
  );
  ```
  The Wing Console should be updated


## Pass configuration from Backend to Frontend

Wing is creating `client/public/wing.js` to be able to pass configuration from Wing backend to 
the frontend code. 

If you examine its' content it is currently:
```js
// This file is generated by wing
window.wingEnv = {};
```

Once we add the following code into `backend/main.w`
```ts
react.addEnvironment("key1", "value1");
```

The running `wing run` command will generate a new version of `client/public/wing.js`:
```js
// This file is generated by wing
window.wingEnv = {
  "key1": "value1"
};
```

Lets see how we can use this mechanism

1. Include `wing.js` in your frontend code - Add the following line inside `client/public/index.html`  (just before the `<title>` section):
     ```html 
     <script src="./wing.js"></script>
     ```
2. Lets see this in action, in  `client/src/App.js` Look for "Learn React" and replace it with:
   ```js
     {window.wingEnv.title || "Learn React"}
   ```
3. Go to `backend/main.w` and add
   ```ts
   react.addEnvironment("title", "Learn React with Wing");
   ```
  
## Call API Gateway and display 

Once we know how to pass parameters from the backend to the client, let use this capability to 
set `window.wingEnv.apiUr` on the client. And fetch the title from our API 
1. To set `apiUrl` go to `backend/main.w` and add:
```ts
  react.addEnvironment("apiUrl", api.url);
```
2. Enable cross origin resource sharing (cors) by adding `cors:true` and `corsOptions: ...` in `backend/main.w`: 
```ts
let api = new cloud.Api(
    cors: true,
    corsOptions: {
      allowHeaders: ["*"],
      allowMethods: [
        http.HttpMethod.OPTIONS, 
        http.HttpMethod.GET, 
        http.HttpMethod.POST, 
        http.HttpMethod.DELETE, 
        http.HttpMethod.PUT,
        http.HttpMethod.HEAD
      ],
   }
  );
```
3. Create a new `/title` route in `backend/main.w`: 
```
  api.get("/title", inflight () => {
    return {
      status:200,
      body: "Hello from Api Gateway"
    };
  });
```
4. Use react hooks in order to read the title from our API Gateway, replace the content of `client/src/App.js` with the following code:
  ```js
  import logo from './logo.svg';
  import {useEffect, useState} from "react";
  import './App.css';

  function App() {
    const [title, setTitle] = useState("Learn React");
    const getTitle = async () => {
    const response = await fetch(`${window.wingEnv.apiUrl}/title`);
    setTitle(await response.text());  
  }

    useEffect(() => {
      getTitle();
    }, []);

    return (
      <div className="App">
        <header className="App-header">
          <img src={logo} className="App-logo" alt="logo" />
          {title}
          </a>
        </header>
      </div>
    );
  }

  export default App;
```

